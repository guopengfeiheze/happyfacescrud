<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:f="http://java.sun.com/jsf/core"
	    xmlns:p="http://primefaces.org/ui"
	    xmlns:hf="http://happyfaces.org/happyfaces"
		xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:composition>
		
		<!-- The required attribute is optional, 
         initialize it to false if not found. -->
	    <c:if test="${empty required}">
	        <c:set var="required" value="false" />
	    </c:if>
	    
	    <c:set var="filtersMap" value="#{backingBean.filters}" />
	    
	    <!-- Default size. -->
	    <c:if test="${empty size}">
	        <c:set var="size" value="20" />
	    </c:if>
 		
 		<!-- Clear Button. -->
	    <c:if test="${empty clearButton}">
	        <c:set var="clearButton" value="false" />
	    </c:if>

	    <!-- No popup is set. -->
	    <c:if test="${empty popup}">
	        <c:set var="popup" value="false" />
	    </c:if>
	    
	    <!-- Search with entity popup -->
	    <c:if test="${popup}">
	        <c:set var="childEntity" value="#{entity[field]}" />
	        	<p:outputLabel for="#{field}" value="#{label}" />
		    	<h:panelGrid id=#{field} columns="2">
		    		<h:column>
				    	<p:inputText value="#{filtersMap[field][childField]}" disabled="true" size="#{size}" />
				    	<p:commandLink  id="selectLink" onclick="Richfaces.showModalPanel('#{popupId}');">
			                 <h:graphicImage value="/img/search.gif" style="border:0"/>
			            </p:commandLink>
						<p:tooltip for="selectLink" value="#{messages['commons.search']}" showEffect="slide" hideEffect="slide" />
			        </h:column>
			        <h:column>
			            <p:commandLink rendered="#{clearButton}" id="clearLink" action="#{filtersMap.put(field, null)}" reRender="formId" >
			                 <h:graphicImage value="/images/delete.gif" style="border:0"/>
			            </p:commandLink>
			            <p:tooltip for="clearLink" value="#{messages['commons.clearField']}" showEffect="slide" hideEffect="slide"/>
			        </h:column>
		        </h:panelGrid>
	    </c:if>

		<!-- Search with entity list in select box -->
	    <c:if test="${!popup}">
	    	<p:outputLabel for="#{field}" value="#{label}" />
	    	<p:selectOneMenu id="#{field}" value="#{filtersMap[field]}" >
			       <f:selectItems value="#{service.list()}" var="childEntity" label="#{childEntity[childField]}" noSelectionLabel=""/>
			</p:selectOneMenu>	
	    </c:if>

		<!-- Search with single childEntity field -->
	    <c:if test="${!popup and empty service}">
	    	<c:set var="childEntity" value="#{entity[field]}" />
	    	<hf:searchField label="#{label}" entity="childEntity" field="#{childField}" time="#{time}" rangeSearch="#{rangeSearch}" size="#{size}" />
	    </c:if>
	    
    </ui:composition>

</html>
